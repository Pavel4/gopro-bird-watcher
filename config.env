# Конфигурация Motion Detector для macOS (MacBook M5)
# Этот файл предназначен для разработки и тестирования на Mac

# === ИСТОЧНИК ВИДЕО ===
# Используем USB режим (GoPro подключена через USB-C)
INPUT_SOURCE=usb

# --- USB режим (macOS) ---
# ВАЖНО: на macOS используйте ИНДЕКС камеры (0, 1, 2, ...), а не путь устройства
# Проверьте индекс через: ffmpeg -f avfoundation -list_devices true -i ""
# На вашем MacBook:
# [0] GoPro Webcam                    ← ИСПОЛЬЗУЕМ ЭТОТ
# [1] Камера MacBook Pro
# [2] Камера Обзора стола MacBook Pro
USB_DEVICE=0

# Разрешение: 480, 720, или 1080
# Для тестирования можно использовать 720p для меньшей нагрузки
USB_RESOLUTION=1080

# FPS: обычно 30 для GoPro
USB_FPS=30

# Пути (для нативного запуска на macOS, не в Docker)
OUTPUT_DIR=./recordings
LOG_FILE=./logs/motion_detector.log
CONTROL_FILE=./control/command

# Буфер записи (секунды)
# BUFFER_SECONDS - сколько секунд ДО начала движения включить в видео
# POST_MOTION_SECONDS - сколько секунд ПОСЛЕ окончания движения записывать
BUFFER_SECONDS=5
POST_MOTION_SECONDS=5

# Пороги для значимого движения (для СТАРТА записи)
MIN_CONTOUR_AREA=500
MIN_MOTION_FRAMES=3
MOTION_AREA_PERCENT=3.0

# Порог для ПРОДЛЕНИЯ записи
# Чем меньше - тем дольше будет записывать при слабом движении
EXTEND_MOTION_PERCENT=0.2

# Режим отладки (показывает % движения в логах)
DEBUG_MOTION=true

# Авто-старт записи при движении (true/false)
AUTO_START_MOTION=true

# Длительность сегмента записи (секунды)
SEGMENT_DURATION=1

# === ROI (Region of Interest) — только детекция движения ===
# ROI определяет ОБЛАСТЬ, в которой анализируется движение
# Используйте select_roi.py для интерактивного выбора
ROI_ENABLED=false
ROI_X=0
ROI_Y=0
ROI_WIDTH=0
ROI_HEIGHT=0

# === CROP — обрезка сохраняемого видео ===
# Отдельно от ROI: можно детектить в маленькой области,
# а записывать более широкую картинку
# Если CROP_X/Y/W/H = 0, используются координаты ROI
CROP_VIDEO_ENABLED=false
CROP_X=0
CROP_Y=0
CROP_WIDTH=0
CROP_HEIGHT=0
# Масштабирование ПОСЛЕ обрезки (WxH или пусто)
# Кодирование происходит ПОСЛЕ crop+scale = макс. качество
CROP_SCALE=

# === УПРАВЛЕНИЕ ХРАНИЛИЩЕМ ===
# Автоматическое удаление записей старше N дней
MAX_RECORDING_AGE_DAYS=30
MIN_FREE_SPACE_GB=10
AUTO_CLEANUP_ENABLED=true
CLEANUP_INTERVAL_HOURS=1

# === TELEGRAM БОТ ===
# Включить/выключить отправку в Telegram
TELEGRAM_ENABLED=false

# Токен и Chat ID задаются в credentials.env (не коммитится в git)
# Скопируйте шаблон: cp credentials.env.example credentials.env
# Или задайте через переменные окружения:
#   export TELEGRAM_BOT_TOKEN=...
#   export TELEGRAM_CHAT_ID=...
TELEGRAM_BOT_TOKEN=
TELEGRAM_CHAT_ID=

# Отправлять видео при обнаружении движения
TELEGRAM_SEND_ON_MOTION=true

# Отправлять видео при ручной записи
TELEGRAM_SEND_MANUAL=false

# Максимальный размер видео для Telegram (в MB)
# Telegram лимит 50MB, ставим 45 для запаса
TELEGRAM_MAX_VIDEO_MB=45

# === МОНИТОРИНГ ПРОИЗВОДИТЕЛЬНОСТИ ===
# Логировать FPS в консоль
ENABLE_FPS_LOGGING=true

# Мониторинг температуры CPU (не актуально для macOS)
ENABLE_CPU_TEMP_MONITORING=false

# === ПРИМЕЧАНИЯ ДЛЯ MACOS ===
# 1. Запускайте детектор НАТИВНО (не в Docker):
#    python detector/motion_detector.py
#
# 2. Установите зависимости:
#    pip install -r detector/requirements.txt
#
# 3. Убедитесь что GoPro в режиме "GoPro Connect":
#    Настройки → Подключения → USB → GoPro Connect
#
# 4. Проверьте список камер:
#    ffmpeg -f avfoundation -list_devices true -i ""
#
# 5. Если FFmpeg не находит камеру, попробуйте другие индексы:
#    USB_DEVICE=0  (встроенная камера Mac)
#    USB_DEVICE=1  (первая внешняя)
#    USB_DEVICE=2  (вторая внешняя)
#
# 6. Для тестирования работы Telegram бота установите:
#    pip install aiogram==3.24.0
